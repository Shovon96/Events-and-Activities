model User {
    id           String     @id @default(uuid())
    email        String     @unique
    password     String
    fullName     String
    status       UserStatus @default(ACTIVE)
    bio          String?
    profileImage String?
    interests    String[]
    city         String?
    role         UserRole   @default(USER)
    createdAt    DateTime   @default(now())
    updatedAt    DateTime   @updatedAt

    hostedEvents    Event[]       @relation("EventHost")
    joinedEvents    Participant[]
    reviewsGiven    Review[]      @relation("ReviewAuthor")
    reviewsReceived Review[]      @relation("ReviewTo")
    payments        Payment[]

    @@map("users")
}

model Event {
    id              String      @id @default(uuid())
    name            String
    type            String
    description     String?
    image           String?
    location        String
    startDate       DateTime
    endDate         DateTime
    minParticipants Int?
    maxParticipants Int?
    // paymentStatus   PaymentStatus @default(UNPAID)
    status          EventStatus @default(OPEN)
    ticketPrice     Float?      @default(0)
    
    // Coupon fields
    couponCode      String?
    couponDiscount  Int?        // Discount percentage (e.g., 20 for 20%)
    couponActive    Boolean     @default(false)
    
    createdAt       DateTime    @default(now())
    updatedAt       DateTime    @updatedAt

    host   User   @relation("EventHost", fields: [hostId], references: [id])
    hostId String

    participants Participant[]
    reviews      Review[]
    payments     Payment[]

    @@map("events")
}

model Participant {
    id     String @id @default(uuid())
    user   User   @relation(fields: [userId], references: [id])
    userId String

    event   Event  @relation(fields: [eventId], references: [id])
    eventId String

    paymentStatus   PaymentStatus @default(UNPAID)
    
    // Coupon tracking
    couponApplied   Boolean       @default(false)
    couponCode      String?
    discountAmount  Float?        @default(0)
    originalPrice   Float?
    finalPrice      Float?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([userId, eventId])
    @@map("participents")
}

model Payment {
    id                 String        @id @default(uuid())
    user               User          @relation(fields: [userId], references: [id])
    userId             String
    event              Event         @relation(fields: [eventId], references: [id])
    eventId            String
    amount             Float
    paymentStatus      PaymentStatus @default(UNPAID)
    transactionId      String?
    paymentGatewayData Json?
    createdAt          DateTime      @default(now())
    updatedAt          DateTime      @updatedAt

    @@map("payments")
}

model Review {
    id        String   @id @default(uuid())
    rating    Decimal  @db.Decimal(2, 1)
    comment   String?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    // from user
    author   User   @relation("ReviewAuthor", fields: [authorId], references: [id])
    authorId String

    // to host
    to   User   @relation("ReviewTo", fields: [toId], references: [id])
    toId String

    // related event
    event   Event  @relation(fields: [eventId], references: [id])
    eventId String

    @@map("reviews")
}
